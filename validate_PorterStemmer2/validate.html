<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      Porter Stemmer 2 Javascript validation suite
    </title>
  </head>
  <body>
    <h1>Porter Stemmer 2 Javascript validation suite</h1>

    <div id="status">
    </div>

    <div id="output">
    </div>
<script type="text/javascript" src="../PorterStemmer2.js"></script>
<script type="text/javascript" src="ReferenceTable.js"></script>
<script type="text/javascript" src="../jsSnowball_0.3/stemmer/src/Among.js"></script>
<script type="text/javascript" src="../jsSnowball_0.3/stemmer/src/SnowballProgram.js"></script>
<script type="text/javascript" src="../jsSnowball_0.3/stemmer/src/ext/EnglishStemmer.js"></script>
<script>
function Snowball(lng) {
  var stemFactory = {
    "EnglishStemmer": EnglishStemmer
  }
  var stemName = lng.substring(0, 1).toUpperCase()
      + lng.substring(1).toLowerCase() + "Stemmer";
  return new stemFactory[stemName]();
}
var stem = (function() {
  var testStemmer = new Snowball("english");
  return function(word) {
    testStemmer.setCurrent(word);
    testStemmer.stem();
    return testStemmer.getCurrent();
  };
  // return f();
  // testStemmer.setCurrent(word);
  // testStemmer.stem();
  // return testStemmer.getCurrent();
}());
</script>
<script>

function runSuite() {
  var 
    $status = document.getElementById("status"),
    $output = document.getElementById("output"),

    input,
    failureList = [],
    reference,
    output;

  for(var i = 0; i < testWords.length; i++) {
    if (i % 100 == 99) {
      $status.innerHTML = "Running. Passed " + (i - failureList.length) + "/" + i + " out of " + testWords.length + " tests.";
    }

    input = testWords[i][0];
    reference = testWords[i][1];

    output = stemmer (input);

    if (output != reference) {
      failureList.push ({
        input: input,
        output: output,
        reference: reference
      });
    }
  }

  $status.innerHTML = "Completed. Passed " + 
    (i - failureList.length) + "/" + i + 
    " out of " + testWords.length + " tests. (" +
    (100 * (1 - failureList.length / i)).toFixed(2) + "%)";

  if (failureList.length > 0) {
    var thead = 
      "<thead>" +
        "<tr>" +
          "<th>input</th>" +
          "<th>output</th>" +
          "<th>reference</th>" +
        "</tr>" +
      "</thead>",
      tbody = [],
      failure;

    for (i = 0; i < failureList.length; i++) {
      failure = failureList[i];

      tbody.push(  
        "<td>" + failure.input + "</td>" +
        "<td>" + failure.output + "</td>" +
        "<td>" + failure.reference + "</td>"
      );
    }
        
    $output.innerHTML = "<table>" + thead + 
      "<tbody>" +
        "<tr>" + tbody.join("</tr><tr>") + "</tr>" +
      "</tbody>" +
    "</table>";
  }
}
function debugOne(w) {
  var stemmed = window.stemmer(w, true);
  console.log(stemmed);
  return stemmed;
}
function test_jsSnowball() {
  window.stemmer = stem;
  runSuite();
  // debugOne("hopefully");
  // console.log(stem("hopefully"));
}
// window.onload = debugOne("hopefully");
// window.onload = runSuite;
window.onload = test_jsSnowball;
</script>
  </body>
</html>
